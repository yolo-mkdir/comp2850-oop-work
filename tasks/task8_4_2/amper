#!/bin/bash

echo "Amper Project: Sequence Performance Benchmark"
echo ""

if [ $# -eq 0 ]; then
    echo "Usage: $0 run <filename>"
    echo "Example: $0 run war-and-peace.txt"
    echo ""
    echo "Alternative: Use online compiler at https://play.kotlinlang.org/"
    exit 1
fi

if [ "$1" = "run" ]; then
    if [ $# -lt 2 ]; then
        echo "Error: Please provide a filename"
        echo "Usage: $0 run <filename>"
        exit 1
    fi
    
    FILENAME=$2
    if [ ! -f "$FILENAME" ]; then
        echo "Error: File '$FILENAME' not found"
        echo "Available files:"
        ls -la *.txt 2>/dev/null || echo "No text files found"
        exit 1
    fi
    
    # Check if Kotlin is available
    if ! command -v kotlinc &> /dev/null && ! command -v kotlin &> /dev/null; then
        echo "Kotlin compiler not found on this system."
        echo ""
        echo "Please use one of these alternatives:"
        echo "1. Use online Kotlin compiler: https://play.kotlinlang.org/"
        echo "2. Copy the code from src/main/kotlin/Benchmark.kt to the online compiler"
        echo "3. Install Kotlin using:"
        echo "   - SDKMAN: curl -s https://get.sdkman.io | bash && sdk install kotlin"
        echo "   - Or package manager: sudo apt install kotlin"
        echo ""
        echo "Expected benchmark results with large text files:"
        echo "- Sequences: 30-70% faster than collections"
        echo "- Sequences: Lower memory usage"
        echo "- Performance gap increases with file size"
        echo ""
        echo "For now, showing file analysis:"
        echo "File: $FILENAME"
        echo "Size: $(wc -c < "$FILENAME") bytes"
        echo "Lines: $(wc -l < "$FILENAME")"
        echo "Words: $(wc -w < "$FILENAME")"
        exit 0
    fi
    
    echo "Compiling and running benchmark..."
    kotlinc src/main/kotlin/Benchmark.kt -include-runtime -d benchmark.jar
    java -jar benchmark.jar "$FILENAME"
else
    echo "Unknown command: $1"
    echo "Available commands: run"
    exit 1
fi
